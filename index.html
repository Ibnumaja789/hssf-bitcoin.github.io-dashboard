<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>HSSF Bitcoin – Real-Time Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@2"></script>
  <style>
    :root { --bg: #121212; --text: #e0e0e0; --card: #1e1e1e; --purple: #9c27b0; }
    @media (prefers-color-scheme: light) {
      :root { --bg: #f8f9fa; --text: #212529; --card: #ffffff; --purple: #6a1b9a; }
    }
    body { margin:0; font-family: 'Segoe UI', sans-serif; background:var(--bg); color:var(--text); }
    .container { max-width:1100px; margin:20px auto; padding:15px; }
    .card { background:var(--card); border-radius:12px; padding:20px; box-shadow:0 4px 12px rgba(0,0,0,0.3); }
    h1 { text-align:center; color:var(--purple); margin:0 0 10px; }
    .controls { display:flex; gap:10px; flex-wrap:wrap; justify-content:center; margin:15px 0; }
    button { padding:10px 16px; border:none; border-radius:8px; background:var(--purple); color:white; cursor:pointer; font-weight:bold; }
    button:hover { opacity:0.9; }
    #chartContainer { position:relative; height:70vh; }
    .footer { text-align:center; margin-top:20px; font-size:0.9em; color:#888; }
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <h1>Teori HSSF – Bitcoin Real-Time</h1>
      <p style="text-align:center; margin:5px 0 15px; font-size:1.1em;">
        Harga saat ini: <strong id="livePrice">$95,000</strong> 
        <span id="change"></span>
      </p>

      <div class="controls">
        <button onclick="downloadChart()">Download PNG</button>
        <button onclick="toggleTheme()">Dark/Light</button>
      </div>

      <div id="chartContainer">
        <canvas id="hssfChart"></canvas>
      </div>

      <div class="footer">
        Kalibrasi: 14 Nov 2025 | Model: HSSF v1.0
      </div>
    </div>
  </div>

  <script>
    // === DATA HSSF ===
    const A = 1.20e-9, k = 6.20, B = 2.80;
    const years = Array.from({length:22}, (_,i) => 2009 + i);
    const t = years.map(y => y - 2009);
    const s2f = [1,1,1,9,25,25,25,50,50,50,112,112,112,112,224,224,224,224,448,448,448,448];
    const hssf = t.map((ti, i) => {
      const cycle = 1 + 0.7 * Math.sin(2 * Math.PI * (ti % 4) / 4);
      const dip = (ti % 4 === 1) ? 0.4 : 1;
      return A * Math.pow(ti + 1, k) * Math.exp(B * Math.log(s2f[i])) * cycle * dip;
    });

    const pricesHist = [0.01,0.05,5,13,751,320,430,600,4000,7500,8000,11000,47000,28000,30000,60000,95000];
    const rsi = [30,35,40,45,85,30,40,70,90,35,60,75,70,40,80,85,88,90,92,93,94,95];

    // === CHART ===
    const ctx = document.getElementById('hssfChart').getContext('2d');
    const chart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: years,
        datasets: [
          {
            label: 'Harga Historis + Real-Time',
            data: pricesHist.map((p,i) => ({x: years[i], y: p})),
            backgroundColor: ctx => {
              const i = ctx.dataIndex;
              if (rsi[i] < 40) return 'blue';
              if (rsi[i] < 50) return 'cyan';
              if (rsi[i] < 60) return 'green';
              if (rsi[i] < 70) return 'yellow';
              if (rsi[i] < 80) return 'orange';
              return 'red';
            },
            pointRadius: 6,
            pointHoverRadius: 9,
            showLine: false
          },
          {
            label: 'HSSF Prediksi',
            data: hssf.map((p,i) => ({x: years[i], y: p})),
            borderColor: 'purple',
            backgroundColor: 'rgba(156,39,176,0.1)',
            fill: false,
            tension: 0.3,
            borderWidth: 3
          },
          {
            label: '200W MA',
            data: Array(22).fill(null).map((_,i) => i>=16 ? 60000 + (i-16)*8000 : null).map((v,i) => ({x: years[i], y: v})),
            borderColor: 'black',
            borderDash: [5,5],
            fill: false,
            pointRadius: 0
          }
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          y: { type: 'logarithmic', title: { display: true, text: 'Harga (USD)' }, ticks: { callback: v => '$' + v.toLocaleString() } },
          x: { title: { display: true, text: 'Tahun' } }
        },
        plugins: {
          legend: { position: 'top' },
          annotation: {
            annotations: {
              p2025: { type: 'label', xValue: 2025, yValue: 95000, content: ['$95K', 'Sekarang'], backgroundColor: 'rgba(0,0,0,0.7)', color: 'white' },
              p2026: { type: 'label', xValue: 2026, yValue: 28500, content: ['$28.5K', 'Dip'], backgroundColor: 'red', color: 'white' },
              p2027: { type: 'label', xValue: 2027, yValue: 365000, content: ['$365K', 'Puncak'], backgroundColor: 'green', color: 'white' }
            }
          }
        }
      }
    });

    // === REAL-TIME UPDATE ===
    async function updatePrice() {
      try {
        const res = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd&include_24hr_change=true');
        const data = await res.json();
        const price = data.bitcoin.usd;
        const change = data.bitcoin.usd_24h_change.toFixed(2);
        document.getElementById('livePrice').textContent = `$${price.toLocaleString()}`;
        document.getElementById('change').innerHTML = `&nbsp;(${change > 0 ? '+' : ''}${change}%)`;
        document.getElementById('change').style.color = change > 0 ? 'lime' : 'red';
        chart.data.datasets[0].data[16].y = price;
        chart.update();
      } catch (e) { console.log("Gagal update"); }
    }
    updatePrice();
    setInterval(updatePrice, 60000);

    function downloadChart() {
      const link = document.createElement('a');
      link.download = 'HSSF_Bitcoin_Prediction.png';
      link.href = chart.toBase64Image();
      link.click();
    }

    function toggleTheme() {
      const isLight = document.body.style.filter === 'invert(1)';
      document.body.style.filter = isLight ? '' : 'invert(1)';
    }
  </script>
</body>
</html>
